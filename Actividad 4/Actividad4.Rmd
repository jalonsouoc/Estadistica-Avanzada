---
title: "Actividad 4 - Análisis de la varianza y repaso del curso"
author: "Jorge Alonso Hernández"
date: '`r format(Sys.Date(),"%e de %B, %Y")`'
output: 
  html_document: 
    toc: yes
    toc_depth: 2
  pdf_document: 
    toc: yes
    toc_depth: 2
    latex_engine: xelatex
classoption: a4paper
---

# 1 Introducción

```{r echo=TRUE, message=FALSE, warning=FALSE}
# Carga de librerías
if (!require('stringr')) install.packages('stringr'); library('stringr')
if (!require('plyr')) install.packages('plyr'); library('plyr')
if (!require('nortest')) install.packages('nortest'); library('nortest')
````

# 2 Lectura del archivo y preparación de los datos

Realizamos la carga del fichero de datos. En este caso nos encontramos con un fichero txt con lo que emplearemos la función en R read.table, emplearemos una variable ruta_txt para almacenar la ruta del fichero con los datos. Dicha ruta la obtenemos con la función en R file.choose.

```{r echo=TRUE, message=FALSE, warning=FALSE}
ruta_txt <- "C:\\Users\\Jorge\\Documents\\Rstudio Workspace\\Estadística Avanzada\\Actividad 4\\CensusIncomedata.txt"
adult <- read.table(ruta_txt, header = TRUE)
````

Vemos los tipos de datos con los que han sido cargadas las variables.

````{r echo=TRUE, message=FALSE, warning=FALSE}
str(adult)
````

Vemos que casi todas son de tipo cadena a excepción de age, education_num y hours_per_week que son de tipo entero y de la variable income que es de tipo numérica.


vemos el resumen de la muestra de datos.

````{r echo=TRUE, message=FALSE, warning=FALSE}
summary(adult)
````

Del resumen podemos destacar que la edad mínima es de 17 años y la edad máxima de 90 años. También podemos observar que el salario mínimo está en 22540 € anuales y el máximo en 68370 € anuales.

Por último observamos un apequeña muestra de los datos del conjunto de datos.

````{r echo=TRUE, message=FALSE, warning=FALSE}
head(adult)
````

## 2.1 Preparación de los datos

Inicialmente comprobaremos la existencia de valores perdidos o valores nulos

````{r echo=TRUE, message=FALSE, warning=FALSE}
colSums(is.na(adult))
colSums(adult == "")
````

Comprobamos que no existen valores perdidos o vacíos en nuestra muestra de datos. Una vez realizada esta comprobación eliminaremos los espacios en blanco iniciales de las variables categóricas para obtener una muestra de mayor calidad.

````{r echo=TRUE, message=FALSE, warning=FALSE}

# Patrón para reemplazar los espacios en blanco iniciales
patron <- "^\\s+"
# Valor a sustituir por los espacios en blanco
sust <- ""

# Reemplazamos en las variables categóricas
adult$sex <- str_replace_all(adult$sex, pattern = patron, sust)
adult$workclass <- str_replace_all(adult$workclass, pattern = patron, sust)
adult$marital_status <- str_replace_all(adult$marital_status, pattern = patron, sust)
adult$occupation <- str_replace_all(adult$occupation, pattern = patron, sust)
adult$race <- str_replace_all(adult$race, pattern = patron, sust)

````

Corregimos el nombrede la séptima variable de forma que pase de llamarse "sex" a llamarse "gender".

````{r echo=TRUE, message=FALSE, warning=FALSE}
adult = rename(adult, c(sex="gender")) 
names(adult)
````

Podemos ver que se realiza correctamente la modificación del nombre de la variable.

Comprobamos ahora la normalidad de la variable salario.

````{r echo=TRUE, message=FALSE, warning=FALSE}
# Histograma
hist(adult$income)

#Gráfico de densidad
plot(density(adult$income))
````

Vemos que los datos tienen una densidad asimétrica, empleamos el test de Lilliefors para comprobar la normalidad de la variable

````{r echo=TRUE, message=FALSE, warning=FALSE}
lillie.test(adult$income)
````

Vemos que el p-valor es menor de 0.05 por lo tanto vemos que los datos del salario no siguen una distribución normal.

Creamos una nueva variable dicotómica denominada "Less50"  de forma que calificaremos binariamente el salario. Dicha variable tomará el valor 1 cuando el salario anual sea inferior a 50000 € y el valor 0 en caso contrario.

`````{r echo=TRUE, message=FALSE, warning=FALSE}
adult$Less50 <- -1
# Variable clasificatoria
limit <- 50

for (i in 1:length(adult$Less50)) {
  adult$Less50[i] <- ifelse(adult$income[i] < limit, 1, 0)
}

#Convertimos a tipo entero
adult$Less50 <- as.integer(adult$Less50)

head(adult)

levels(factor(adult$race))
````

Comprobamos que se ha generado correctamente la nueva variable con los valores establecidos

## 2.2 Análisis visual

Mostramos los diagramas de caha de la variable income en función del resto de variables cualitativas.

`````{r echo=TRUE, message=FALSE, warning=FALSE}
boxplot(formula = income  ~ gender, data = adult, main = "income en función de gender")
````

Se puede apreciar como los salarios son mayores en hombres que en mujeres.

`````{r echo=TRUE, message=FALSE, warning=FALSE}
boxplot(formula = income  ~ race, data = adult, main = "income en función de race")
````

En este caso podemos apreciar que los salarios de las personas de raza blanca son mayores que los del resto de razas.

`````{r echo=TRUE, message=FALSE, warning=FALSE}
boxplot(formula = income  ~ workclass, data = adult, main = "income en función de workclass")
````

En cuanto al perfil laboral s eobserva que los salarios mayores se encuentran en los trabajadores gubernamentales.

`````{r echo=TRUE, message=FALSE, warning=FALSE}
boxplot(formula = income  ~ marital_status, data = adult, main = "income en función de marital_status")
````

Podemos observar que los salarios más altos se pueden encotnrar en las personas casadas.

`````{r echo=TRUE, message=FALSE, warning=FALSE}
boxplot(formula = income  ~ occupation, data = adult, main = "income en función de occupation")
````

Por último vemos que los trabajadores con un mayor salario se encuentran en los denominados trabajadores de cuello blanco que hace referencia a llos trabajadores que realizan trabajos semiprofesionales o profesionales de oficina, administración y coordinación de ventas.

Observamos las variables cuantitativas.

`````{r echo=TRUE, message=FALSE, warning=FALSE}
hist(adult$age, main = "Age")
````

Observamos que las edades predominantes se encuentran entre los 20 y 40 años.

`````{r echo=TRUE, message=FALSE, warning=FALSE}
hist(adult$hours_per_week, main = "Hours per week")
````

Para la shoras semanales podemos observar que la gran mayoría se encuentra entre las 35 y las 40 horas semanales

`````{r echo=TRUE, message=FALSE, warning=FALSE}
hist(adult$education_num, main = "Education num")
````

Por último observamos que el número de años de formación educativa predominanate es el de 9 años.

# 3 Estadística inferencial

## 3.1 Contraste de hipótesis

### 3.1.1 Hipótesis nula y alternativa

### 3.1.2 Justificación del test a aplicar

### 3.1.3 Aplicación, interpretación y comprobación del test

# 4 Modelo de regresión lineal

## 4.1 Estimación de modelos

## 4.2 Interpretación de los modelos

## 4.3 Análisis de residuos

## 4.4 Predicción

# 5 Regresión logística

## 5.1 Generación de los conjuntos de entrenamiento de test

## 5.2 Modelo predictivo

## 5.3 Interpretación

## 5.4 Matriz de confusión

## 5.5 Predicción

# 6 Análisis de la varianza (ANOVA) de un factor

## 6.1 Visualización

## 6.2 Modelo ANOVA

# 7 ANOVA multifactorial

## 7.1 Estudio visual de la interacción

# 8 Conclusiones